<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<Import Project="$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets"/>
	<!-- http://code.google.com/p/msbuildteamcitytasks/ -->
	<Import Project="$(MSBuildExtensionsPath)\MSBuildTeamCityTasks\MSBuild.TeamCity.Tasks.Targets"/>
	<PropertyGroup>
		<Major>1</Major>
		<Minor>1</Minor>
		<Build>0</Build>
		<Revision>0</Revision>
		<ProjectName>pg</ProjectName>
		<TestsFileNameWithoutExt>pgt</TestsFileNameWithoutExt>
		<Configuration>Release</Configuration>
		<TargetName>$(ProjectName)</TargetName>
		<Source>pg\pg.c pg\pglib.c</Source>
	</PropertyGroup>
	<ItemGroup>
        <OutputDirectory Include="$(MSBuildProjectDirectory)\$(Configuration)\icl"/>
        <OutputDirectory Include="$(MSBuildProjectDirectory)\$(Configuration)\gcc"/>
        <OutputDirectory Include="$(MSBuildProjectDirectory)\$(Configuration)\tcc"/>
    </ItemGroup>
	<Target Name="CreateDirectories">
		<MakeDir Directories="@(OutputDirectory)"/>
	</Target>
	<Target Name="Compile" DependsOnTargets="CreateDirectories">
		<MSBuild Projects="pg.sln" Properties="Configuration=$(Configuration);Platform=Win32" />
		<MSBuild Projects="pg.sln" Properties="Configuration=$(Configuration);Platform=x64" />
		<Exec
			Condition=" '$(ICPP_COMPILER11)'!='' "
			WorkingDirectory="$(MSBuildProjectDirectory)"
			Command='"$(ICPP_COMPILER11)bin\ia32\icl.exe" /O3 /Qprec-div /QxSSE2 /Qopt-report:3 /Qopt-report-phase:all /DWIN32 /Fe$(MSBuildProjectDirectory)\$(Configuration)\icl\$(TargetName).exe $(Source) "$(ICPP_COMPILER11)lib\ia32\libmmt.lib" "$(ICPP_COMPILER11)lib\ia32\libirc.lib" "$(ICPP_COMPILER11)lib\ia32\svml_disp.lib" "$(ICPP_COMPILER11)lib\ia32\libdecimal.lib"'
		/>
		<Exec
			Condition=" '$(QT_BASE)'!='' "
			WorkingDirectory="$(MSBuildProjectDirectory)"
			Command='$(QT_BASE)\..\mingw\bin\gcc.exe -O3 -msse2 -mmmx -static -s -o $(MSBuildProjectDirectory)\$(Configuration)\gcc\$(TargetName).exe $(Source)'
		/>
		<Exec
			Condition=" '$(TCC_PATH)'!='' "
			WorkingDirectory="$(MSBuildProjectDirectory)"
			Command='$(TCC_PATH)\tcc.exe -DWIN32 -o $(MSBuildProjectDirectory)\$(Configuration)\tcc\$(TargetName).exe $(Source)'
		/>
	</Target>
	<Target Name="Tests" DependsOnTargets="Compile">
		<Exec Command="$(Configuration)\$(TestsFileNameWithoutExt).exe --gtest_output=xml:" Timeout="30000" IgnoreExitCode="true"/>
		<ImportGoogleTests ContinueOnFailures="false" TestResultsPath="$(MSBuildProjectDirectory)\$(TestsFileNameWithoutExt).xml"/>
	</Target>
	<Target Name="Build" DependsOnTargets="Tests">
		<Message Text="Primes Generator Build Complete"/>
	</Target>
</Project>